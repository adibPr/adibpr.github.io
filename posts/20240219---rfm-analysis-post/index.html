<!DOCTYPE html>
<html lang="en-us"><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-sccale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" integrity="sha512-b2QcS5SsA8tZodcDtGRELiGv5SaKSk1vDHDaQRda0htPYWZ6046lr3kJ5bAAQdpV2mmA/4v0wQF9MyU6/pDIAg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap-grid.min.css" integrity="sha512-ZuRTqfQ3jNAKvJskDAU/hxbX1w25g41bANOVd1Co6GahIe2XjM6uVZ9dh0Nt3KFCOA061amfF2VeL60aJXdwwQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap-reboot.min.css" integrity="sha512-ZHQv/ue+hZQ+Jd+JKhxic17TUraZ9UwS6G7RcwSrQEE9j/m/AGRwj1OmYrkP43H0B/Wf0pg3hfbHCMAS6SGHOg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" type="text/css" href="../../css/mine.css">

  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

  <script src="../../js/theme.js"></script>
  <title>Adib.notes|RFM Segmentation and Analysis with Python</title>

</head>
<body>
        <div class="containers">
            <div id="navigation"><div id="mynav">
  <ul class="nav justify-content-center">
    <li class="nav-item">
      <a class="nav-link active" href="../../"> Home </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="../../tags"> Tags </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="../../project"> Project & Talks </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="../../about"> About </a>
    </li>
  </ul>
</div>
</div>
            <div id="lsidebar"></div>
            <div id="main">
  <center>
    <h1>RFM Segmentation and Analysis with Python</h1>
    

<time datetime="2024-01-31">Jan 31, 2024</time>


    
    
    
    
        
    
    <br>
    
      
        
        <a class="btn btn-sm btn-outline-success tag-btn tag" href="../../tags/python">python</a>
      
        
        <a class="btn btn-sm btn-outline-success tag-btn tag" href="../../tags/data-scientist">data scientist</a>
      
        
        <a class="btn btn-sm btn-outline-success tag-btn tag" href="../../tags/data-analysis">data analysis</a>
      
    
  </center>
  <br>

  <div id="content">
    <p>A good understanding of the customer is key to a successful business.
Not all customers are created equally. Some (like me), might want the cheapest/free offer, others perhaps willing to pay more to get a premium service, and some might still doubt taking our full offer.
Some might be happy with the product and thus keep using it, while others may be on the verge of churning due to various reasons.
Different customer needs different actions and treatments, and segmentation is one way to explore it.</p>
<p>Customer segmentation involves grouping customers based on shared characteristics.
We could do segmentation based on various aspects, such as demographic information (such as age, and gender), geographic (location), or even psychographics (application usage behavior).
In this post, I&rsquo;ll talk about RFM Segmentation, a segmentation based on Recency, Frequency, and Monetary (normally of transactions) from a user.
This segmentation is quite powerful because RFM segmentation is directly linked to customer purchasing behavior, offering more actionable insights towards our customer.</p>
<h1 id="data-loading">Data Loading</h1>
<p>First, let&rsquo;s talk about the data. For this experiment, I&rsquo;ll be using a sample online retail dataset that I got from <a href="https://www.kaggle.com/datasets/carrie1/ecommerce-data">Kaggle</a>.
This is transactional data per user across several countries.
Here, I put the data into <code>../data</code> folder.
Since we are interested in only valid data, after loading the dataset, I&rsquo;ll only remove all rows that contain NULL values and we will not doing any further data cleaning.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/data.csv&#39;</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">&#34;ISO-8859-1&#34;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>(541909, 8)
</code></pre>
<p>In the end, we have around 542k transactions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>InvoiceNo</th>
      <th>StockCode</th>
      <th>Description</th>
      <th>Quantity</th>
      <th>InvoiceDate</th>
      <th>UnitPrice</th>
      <th>CustomerID</th>
      <th>Country</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>536365</td>
      <td>85123A</td>
      <td>WHITE HANGING HEART T-LIGHT HOLDER</td>
      <td>6</td>
      <td>2010-12-01 08:26:00</td>
      <td>2.55</td>
      <td>17850.0</td>
      <td>United Kingdom</td>
    </tr>
    <tr>
      <th>1</th>
      <td>536365</td>
      <td>71053</td>
      <td>WHITE METAL LANTERN</td>
      <td>6</td>
      <td>2010-12-01 08:26:00</td>
      <td>3.39</td>
      <td>17850.0</td>
      <td>United Kingdom</td>
    </tr>
    <tr>
      <th>2</th>
      <td>536365</td>
      <td>84406B</td>
      <td>CREAM CUPID HEARTS COAT HANGER</td>
      <td>8</td>
      <td>2010-12-01 08:26:00</td>
      <td>2.75</td>
      <td>17850.0</td>
      <td>United Kingdom</td>
    </tr>
    <tr>
      <th>3</th>
      <td>536365</td>
      <td>84029G</td>
      <td>KNITTED UNION FLAG HOT WATER BOTTLE</td>
      <td>6</td>
      <td>2010-12-01 08:26:00</td>
      <td>3.39</td>
      <td>17850.0</td>
      <td>United Kingdom</td>
    </tr>
    <tr>
      <th>4</th>
      <td>536365</td>
      <td>84029E</td>
      <td>RED WOOLLY HOTTIE WHITE HEART.</td>
      <td>6</td>
      <td>2010-12-01 08:26:00</td>
      <td>3.39</td>
      <td>17850.0</td>
      <td>United Kingdom</td>
    </tr>
  </tbody>
</table>
</div>


<p>From this data, the next step that we need to do is to construct Recency, Frequency, and Monetary features from each user.</p>
<h2 id="recency">Recency</h2>
<p>In order to get recency per user, we first need to find out when the last transaction date from the data.
We will use that date (the latest date) as the base date to find how recently the customer made a transaction.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">MAX_DATE</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">MAX_DATE</span>
</span></span></code></pre></div><pre><code>datetime.date(2011, 12, 9)
</code></pre>
<p>After we have the base date, then we could aggregate per user, find the date of their last transaction, and subtract our base date from the date of their last transaction to get their recency.
Here, the lower the recency is the better.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s_recency</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)[</span><span class="s1">&#39;InvoiceDate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">MAX_DATE</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">date</span><span class="p">())</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s_recency</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>CustomerID
12346.0    325
12347.0      2
12348.0     75
12349.0     18
12350.0    310
Name: InvoiceDate, dtype: int64
</code></pre>
<h2 id="frequency">Frequency</h2>
<p>For frequency, all we need to do is count each customer&rsquo;s total invoice ID. In these metrics, the higher the value, the more valuable the customers are (since they make frequent purchases).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s_frequency</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)[</span><span class="s1">&#39;InvoiceNo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">s_frequency</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div><pre><code>CustomerID
12346.0    2
12347.0    7
12348.0    4
12349.0    1
12350.0    1
Name: InvoiceNo, dtype: int64
</code></pre>
<h2 id="monetary">Monetary</h2>
<p>Lastly, for monetary, we first need to find the total amount per transaction by multiplying the quantity by the price per unit. Then from that, we could aggregate per user and sum the total amount per transaction.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df</span><span class="p">[</span><span class="s1">&#39;TotalPrice&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UnitPrice&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">s_monetary</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">)[</span><span class="s1">&#39;TotalPrice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></span></code></pre></div><p>To make everything easier, let&rsquo;s combine the three series into a single dataframe.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">s_recency</span><span class="p">,</span> <span class="n">s_frequency</span><span class="p">,</span> <span class="n">s_monetary</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="c1"># replace the column name</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Monetary&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CustomerID</th>
      <th>Recency</th>
      <th>Frequency</th>
      <th>Monetary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12346.0</td>
      <td>325</td>
      <td>2</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12347.0</td>
      <td>2</td>
      <td>7</td>
      <td>4310.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12348.0</td>
      <td>75</td>
      <td>4</td>
      <td>1797.24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12349.0</td>
      <td>18</td>
      <td>1</td>
      <td>1757.55</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12350.0</td>
      <td>310</td>
      <td>1</td>
      <td>334.40</td>
    </tr>
  </tbody>
</table>
</div>


<p>There are two ways to do segmentation using RFM.</p>
<ol>
<li>Either we create segmentation separately based on the Recency, Frequency, and Monetary values of each user and then combine them, or</li>
<li>We could use the raw Recency, Frequency, and Monetary data and feed it into a clustering algorithm to find clusters automatically.</li>
</ol>
<p>First, let&rsquo;s explore the first option. In this option, we make separate segmentation first on each R, F, and M, and then combine them together to get the final segment.</p>
<h1 id="manual-rfm">Manual RFM</h1>
<p>To make segmentation for each R, F, and M manually, the simplest technique that we could use is by using quartile.
By dividing the data using it&rsquo;s quartile, we will get 4 group/score from each R, F, and M.</p>
<h2 id="quartile-segmentation">Quartile Segmentation</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Monetary_Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Monetary&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[[</span><span class="s1">&#39;Monetary&#39;</span><span class="p">,</span> <span class="s1">&#39;Monetary_Score&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Monetary</th>
      <th>Monetary_Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4310.00</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1797.24</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1757.55</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>334.40</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>


<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Frequency_Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Score&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Frequency</th>
      <th>Frequency_Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>


<p>For frequency, we are using 3 bins only, since there are so many single transactions in the data that when we want to make a cut using 4 bins, the minimum and the first quartile have the same value (i.e. 1). This means more than 25% of our transactions are only one, therefore we have duplicate edges.</p>
<p>On Recency, we will score it in reverse, since for Recency, the lower the number is the better. We want to asociate group 4 with the lowest recency, highest monetary and higest frequency.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Recency_Score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;Recency&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">    <span class="n">q</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[[</span><span class="s1">&#39;Recency&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Score&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Recency</th>
      <th>Recency_Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>325</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>75</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>310</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="o">.</span><span class="n">head</span><span class="p">()[[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;Monetary_Score&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Score&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Score&#39;</span><span class="p">]]</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CustomerID</th>
      <th>Monetary_Score</th>
      <th>Frequency_Score</th>
      <th>Recency_Score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12346.0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12347.0</td>
      <td>4</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12348.0</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12349.0</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12350.0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>


<h2 id="rfm-segments-classification">RFM Segments Classification</h2>
<p>After we assign a group/score to our customer based on each of the R, F, and M attributes, the final step is to make segments based on this.
There are many ways to make segments for RFM, and it&rsquo;s more of an art than a science.
Normally it depends on business needs and many other factors.
Here, we will define 7 segments:</p>
<ol>
<li><strong>Big Fish</strong>, our most valuable customer. Recent, frequent, and high-spending individuals. They contribute significantly to revenue and are crucial for sustained business success.</li>
<li><strong>Loyal Customer</strong>, customers that keep coming back frequently and have made recent purchases, even though the spending value is less than Big Fish.</li>
<li><strong>Regular Customer</strong>, customers with a balance across recency, frequency, and monetary aspects. They are consistent buyers who contribute steadily to the business.</li>
<li><strong>Infrequent Customer</strong>, customers who make sporadic purchases, showing lower engagement and frequency.</li>
<li><strong>Lost Customer</strong>, has not engaged recently, has made few purchases, and contributes minimally to revenue.</li>
<li><strong>Can&rsquo;t Lose</strong>, customers who used to have frequent and high-value purchases but not recently.</li>
<li><strong>About to Churn</strong>, customers who might be considering leaving, with the last purchase a long time ago and it&rsquo;s not a high-value purchase.</li>
</ol>
<p>Based on the business definition above, then we could create a function that will return the category of a user based on its R, F, and M scores.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">make_category</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">R</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">F</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;Big Fish&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">R</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">F</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;Regular Customer&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">R</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">F</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;Seasonal/New Customer&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">R</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">F</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&#34;Can&#39;t Lose&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">R</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;About to Churn&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">R</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;Lost Customer&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;??&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_rfm</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">make_category</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Recency_Score&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Frequency_Score&#39;</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="p">[</span><span class="s1">&#39;Monetary_Score&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CustomerID</th>
      <th>Recency</th>
      <th>Frequency</th>
      <th>Monetary</th>
      <th>Monetary_Score</th>
      <th>Frequency_Score</th>
      <th>Recency_Score</th>
      <th>category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12346.0</td>
      <td>325</td>
      <td>2</td>
      <td>0.00</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>Lost Customer</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12347.0</td>
      <td>2</td>
      <td>7</td>
      <td>4310.00</td>
      <td>4</td>
      <td>3</td>
      <td>4</td>
      <td>Big Fish</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12348.0</td>
      <td>75</td>
      <td>4</td>
      <td>1797.24</td>
      <td>4</td>
      <td>2</td>
      <td>2</td>
      <td>Can't Lose</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12349.0</td>
      <td>18</td>
      <td>1</td>
      <td>1757.55</td>
      <td>4</td>
      <td>1</td>
      <td>3</td>
      <td>Seasonal/New Customer</td>
    </tr>
    <tr>
      <th>4</th>
      <td>12350.0</td>
      <td>310</td>
      <td>1</td>
      <td>334.40</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>Lost Customer</td>
    </tr>
  </tbody>
</table>
</div>


<p>We could aggregate the category to find out the overall distribution of our customers.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm_cat</span> <span class="o">=</span> <span class="n">df_rfm</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="s1">&#39;total&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_rfm_cat</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">)</span>
</span></span></code></pre></div><pre><code>&lt;Axes: xlabel='total', ylabel='category'&gt;
</code></pre>
<p><img src="https://bucket1.is3.cloudhost.id/blog/20240219%20-%20RFM%20Analysis%20Post/out_35_1.png" alt="png"></p>
<h1 id="unsupervised-learning-rfm">Unsupervised Learning RFM</h1>
<p>Apart from manually quartile to segment the data, we could use another technique such as clustering to automatically find clusters from the data.
Then, we could try to derive the characteristics of each segment based on the clustered data.
In this simple experiment, we will use the good ol&rsquo; day  K-Means to find the segment.</p>
<h2 id="data-scaling">Data Scaling</h2>
<p>Since the data has a different range (i.e. price in hundred thousand, but frequency in 1-100), it&rsquo;s a good idea to scale the data so that when doing distance calculation, one variable doesn&rsquo;t hugely impact the calculation.
We could use Z-score normalization to transform the data to have a mean of 0 and a standard deviation of 1, so all the variables has the same range.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</span></span><span class="line"><span class="cl"><span class="n">scaler</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># process one by one</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Monetary&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">scaler</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">df_rfm</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_Scaled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_rfm</span><span class="p">[[</span><span class="n">key</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[[</span><span class="s1">&#39;Monetary&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Monetary_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Scaled&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Monetary</th>
      <th>Recency</th>
      <th>Frequency</th>
      <th>Monetary_Scaled</th>
      <th>Frequency_Scaled</th>
      <th>Recency_Scaled</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.00</td>
      <td>325</td>
      <td>2</td>
      <td>-0.231001</td>
      <td>-0.329362</td>
      <td>2.316568</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4310.00</td>
      <td>2</td>
      <td>7</td>
      <td>0.293432</td>
      <td>0.206102</td>
      <td>-0.889050</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1797.24</td>
      <td>75</td>
      <td>4</td>
      <td>-0.012316</td>
      <td>-0.115176</td>
      <td>-0.164560</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1757.55</td>
      <td>18</td>
      <td>1</td>
      <td>-0.017146</td>
      <td>-0.436455</td>
      <td>-0.730258</td>
    </tr>
    <tr>
      <th>4</th>
      <td>334.40</td>
      <td>310</td>
      <td>1</td>
      <td>-0.190312</td>
      <td>-0.436455</td>
      <td>2.167700</td>
    </tr>
  </tbody>
</table>
</div>


<h2 id="find-the-best-k">Find the best K</h2>
<p>After the data is ready to be fed into our model, the next part is to find the best parameter.
Since we are using vanilla KMeans, the most important parameter we need to choose is the number of clusters we want ($k$) since this algorithm can&rsquo;t detect it automatically.
One way we could find the best cluster is by a method called <a href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)"><em>elbow method</em></a> that are available in the package from <a href="https://www.scikit-yb.org/en/latest/">yellowbrick</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">yellowbrick.cluster</span> <span class="kn">import</span> <span class="n">KElbowVisualizer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">visualizer</span> <span class="o">=</span> <span class="n">KElbowVisualizer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="o">=</span> <span class="n">df_rfm</span><span class="p">[[</span><span class="s1">&#39;Monetary_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Scaled&#39;</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">visualizer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="https://bucket1.is3.cloudhost.id/blog/20240219%20-%20RFM%20Analysis%20Post/out_42_1.png" alt="png"></p>
<p>Based on the visualization above, it seems the most optimum K (given by the black dashed line) is around 8. So let&rsquo;s settle with that.</p>
<h2 id="modeling">Modeling</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cluster_size</span> <span class="o">=</span> <span class="n">df_rfm</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">cluster_size</span>
</span></span></code></pre></div><pre><code>cluster
0    2284
1     767
2       3
3     584
4     101
5       3
6     612
7      18
dtype: int64
</code></pre>
<p>It seems from out cluster, we have several cluster that only consists of few data. Since this probably doesn&rsquo;t have any information, we will drop any clusters with members below 20.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm_filtered</span> <span class="o">=</span> <span class="n">df_rfm</span><span class="p">[</span><span class="n">df_rfm</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cluster_size</span><span class="p">[</span><span class="n">cluster_size</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>
</span></span></code></pre></div><h2 id="interpreting-result">Interpreting Result</h2>
<p>In order to interpret the result, we can plot each cluster based on it&rsquo;s R, F, and M value. From there, we could figure out what kind of customer that cluster representing.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">df_rfm_filtered</span><span class="p">[[</span><span class="s1">&#39;Monetary_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">]]</span>
</span></span></code></pre></div>

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Monetary_Scaled</th>
      <th>Recency_Scaled</th>
      <th>Frequency_Scaled</th>
      <th>cluster</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.231001</td>
      <td>2.316568</td>
      <td>-0.329362</td>
      <td>6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.293432</td>
      <td>-0.889050</td>
      <td>0.206102</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.012316</td>
      <td>-0.164560</td>
      <td>-0.115176</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.017146</td>
      <td>-0.730258</td>
      <td>-0.436455</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.190312</td>
      <td>2.167700</td>
      <td>-0.436455</td>
      <td>6</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4367</th>
      <td>-0.209026</td>
      <td>1.840191</td>
      <td>-0.436455</td>
      <td>6</td>
    </tr>
    <tr>
      <th>4368</th>
      <td>-0.221167</td>
      <td>0.877514</td>
      <td>-0.436455</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4369</th>
      <td>-0.209513</td>
      <td>-0.839427</td>
      <td>-0.222269</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4370</th>
      <td>0.023900</td>
      <td>-0.879125</td>
      <td>1.169939</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4371</th>
      <td>-0.007444</td>
      <td>-0.492069</td>
      <td>-0.222269</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>4348 rows × 4 columns</p>
</div>


<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># we need to convert our data into Tidy dataset first to be able to plot multiple boxplot</span>
</span></span><span class="line"><span class="cl"><span class="n">tidy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">df_rfm_filtered</span><span class="p">,</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CustomerID&#39;</span><span class="p">,</span> <span class="s1">&#39;cluster&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Monetary_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Recency_Scaled&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency_Scaled&#39;</span><span class="p">])</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&#34;cluster&#34;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&#34;value&#34;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&#34;variable&#34;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tidy_df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&#34;Set1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Cluster ID&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Scaled Value&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;R, F, M Value Distribution Per Cluster&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sns</span><span class="o">.</span><span class="n">move_legend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="s2">&#34;upper left&#34;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Variable&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="https://bucket1.is3.cloudhost.id/blog/20240219%20-%20RFM%20Analysis%20Post/out_53_0.png" alt="png"></p>
<p>Based on the graph above, we can identify the pattern among the clusters.
For example:</p>
<ul>
<li>We could clearly see cluster <strong>#4</strong> is our most important customer, with high Monetary and Frequency, and also low Recency (meaning they made a purchase recently).</li>
<li>On the contrary, cluster <strong>#6</strong> is our churn customer, identified by having a high score in Recency value, which means the last transaction they made was from a long time ago.</li>
<li>Cluster <strong>#3</strong> is our regular customer, even though the purchasing power isn&rsquo;t as strong as cluster #4, it still made frequent purchases recently.</li>
<li>Cluster <strong>#0</strong> is probably our new customer, with recent transactions but with small and infrequent transactions.</li>
<li>Lastly, our cluster <strong>#1</strong> could be a customer who is about to churn, with a quite high recency score and low frequency and recency (albeit not as low as cluster #6).</li>
</ul>
<h1 id="follow-up">Follow Up</h1>
<p>So, after we create the segmentation, what could we do next? How could this information help our business? RFM segmentation could help us to give a specific treatment to the right group.</p>
<p>For example, an &ldquo;<em>about-to-churn</em>&rdquo; customer might need regular notification about the benefit of our product, or if this customer is new but already about to churn, then we could gather feedback from them, what part of our product needs to improve, etc.
For &ldquo;regular customers&rdquo;, the ideal path is most likely to increase purchasing power or the total transaction, either by giving the best recommendation or by giving incentives if they purchase in bulk.</p>
<p>This &lsquo;special&rsquo; treatment based on the group&rsquo;s needs is what makes the business thrive. Focus on what our customer needs and want, knowing that each customer (or in this case, each segment) is different.</p>

  </div>

</div>
            <div id="rsidebar"></div>
            <div id="theme"> 
                <a href="#" class="nav-link" onclick="changeTheme()"><i data-feather="sun"></i></a>
            </div>
            <div id="footer"><script src="https://code.jquery.com/jquery-3.7.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.1/feather.min.js" integrity="sha512-4lykFR6C2W55I60sYddEGjieC2fU79R7GUtaqr3DzmNbo0vSaO1MfUjMoTFYYuedjfEix6uV9jVTtRCSBU/Xiw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  feather.replace()
</script>
</div>
        </div>
    </body>
</html>
